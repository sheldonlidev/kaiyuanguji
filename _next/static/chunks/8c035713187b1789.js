(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},85130,89271,e=>{"use strict";var t,r=((t={}).WORK="work",t.COLLECTION="collection",t.BOOK="book",t);e.s(["BookResourceType",()=>r],89271);var s=e.i(85149);let a={};async function n(e,t){try{let s=await fetch(e,{cache:"no-store",signal:AbortSignal.timeout(5e3)});if(!s.ok)throw Error(`Failed to fetch from ${e}: ${s.statusText}`);let a=await s.json(),n=[],l=(e,r)=>{e&&Object.values(e).forEach(e=>{let s=(e.path||"").split("/");s.pop();let a=s.join("/"),l=a?`${a}/${e.id}`:e.id;n.push({id:e.id,name:e.title||e.name,type:r,isDraft:t,rawPath:e.path,localPath:e.path,assetPath:l,author:e.author,collection:e.collection,year:e.year,holder:e.holder})})};return l(a.books,r.BOOK),l(a.collections,r.COLLECTION),l(a.works,r.WORK),n}catch(e){throw e}}async function l(e="github"){if(a[e])return a[e];let t=[];if(s.isLocalMode)try{let t=await n("/local-data/index.json",!0);if(t.length>0)return console.log("Using local index data from book-index-draft"),a[e]=t,t}catch(e){console.warn("Local index not found, falling back to remote strategies")}let r=async t=>{if("github"===e)return n(t?s.GITHUB_BOOK_INDEX_DRAFT:s.GITHUB_BOOK_INDEX,t);let r=t?"book-index-draft":"book-index",a="main",l=`${s.JSDELIVR_FASTLY}/${s.GITHUB_ORG}/${r}@${a}/index.json`,o=`${s.JSDELIVR_CDN}/${s.GITHUB_ORG}/${r}@${a}/index.json`;try{return await n(l,t)}catch(e){return console.warn("Fastly index fetch failed, trying fallback:",e),await n(o,t)}};try{let e=await r(!0);t.push(...e)}catch(t){console.warn(`Failed to fetch draft index from ${e}:`,t)}try{let e=await r(!1);t.push(...e)}catch(t){console.warn(`Failed to fetch official index from ${e}:`,t)}let o=new Map;t.forEach(e=>{o.set(e.id,e)});let i=Array.from(o.values());return a[e]=i,i}async function o(e,t="github"){return(await l(t)).find(t=>t.id===e)||null}async function i(e,t="github"){if(s.isLocalMode&&e.localPath)try{let t=`/local-data/${e.localPath}`,r=await fetch(t,{cache:"no-store"});if(r.ok){console.log(`Using local book detail for ${e.id} from ${t}`);let s=await r.json();return await c(e,s)}}catch(e){console.warn("Local detail fetch failed, falling back to remote:",e)}if("github"===t){let r=`${s.GITHUB_BASE}/${s.GITHUB_ORG}/${e.isDraft?"book-index-draft":"book-index"}/main/${encodeURI(e.rawPath)}`,a=await fetch(r,{cache:"no-store"});if(!a.ok)throw Error(`Failed to fetch book detail from ${t}: ${a.statusText}`);let n=await a.json();return await c(e,n)}let r=e.isDraft?"book-index-draft":"book-index",a="main",n=`${s.JSDELIVR_FASTLY}/${s.GITHUB_ORG}/${r}@${a}/${encodeURI(e.rawPath)}`,l=`${s.JSDELIVR_CDN}/${s.GITHUB_ORG}/${r}@${a}/${encodeURI(e.rawPath)}`;try{let t=await fetch(n,{cache:"no-store",signal:AbortSignal.timeout(8e3)});if(!t.ok)throw Error(`Fastly status: ${t.status}`);let r=await t.json();return await c(e,r)}catch(s){console.warn("Fastly fetch failed, trying fallback CDN:",s);let t=await fetch(l,{cache:"no-store",signal:AbortSignal.timeout(1e4)});if(!t.ok)throw Error(`Failed to fetch book detail from CDN: ${t.statusText}`);let r=await t.json();return await c(e,r)}}async function c(e,t){let r=e.id;if(s.isLocalMode)try{let s=e.assetPath?`/local-data/${e.assetPath}`:`/books/${r}`,a=`${s}/images/image_manifest.json`;(await fetch(a,{method:"HEAD"})).ok&&(t.digital_assets={image_manifest_url:a,tex_files:["ce01.tex"]})}catch(e){}return t}function d(e){switch(e){case r.WORK:return"ä½œå“";case r.COLLECTION:return"ä¸›ç¼–";case r.BOOK:return"ä¹¦";default:return""}}function x(e){return e?"è‰ç¨¿":"æ­£å¼"}e.s(["fetchAllBooks",()=>l,"fetchBookDetail",()=>i,"findBookById",()=>o,"getStatusLabel",()=>x,"getTypeLabel",()=>d],85130)},81827,e=>{"use strict";var t=e.i(18050),r=e.i(71645),s=e.i(22016),a=e.i(85130),n=e.i(67920),l=e.i(89271);function o({id:e,children:o,className:i,...c}){let{source:d}=(0,n.useSource)(),[x,h]=(0,r.useState)(null),[u,m]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let t=!0;return(async()=>{try{let r=await (0,a.findBookById)(e,d);t&&r&&(h(r.type),m(r.name))}catch(t){console.error(`Failed to fetch book info for ID: ${e}`,t)}})(),()=>{t=!1}},[e,d]),(0,t.jsxs)(s.default,{href:`/book-index/${e}`,className:`inline-flex items-center text-vermilion hover:underline font-medium decoration-dotted underline-offset-4 ${i||""}`,...c,children:[(()=>{let e="w-3.5 h-3.5 inline-block mr-1 opacity-70 align-middle";switch(x){case l.BookResourceType.BOOK:return(0,t.jsx)("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})});case l.BookResourceType.COLLECTION:return(0,t.jsx)("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})});case l.BookResourceType.WORK:return(0,t.jsx)("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})});default:return null}})(),(0,t.jsx)("span",{children:u||o||e})]})}e.s(["default",()=>o])},45013,e=>{"use strict";var t=e.i(18050),r=e.i(71645),s=e.i(22016),a=e.i(42303),n=e.i(85130);function l({text:e,label:s}){let[a,n]=(0,r.useState)(!1),l=async()=>{try{await navigator.clipboard.writeText(e),n(!0),setTimeout(()=>n(!1),2e3)}catch(e){console.error("Failed to copy:",e)}};return(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[s&&(0,t.jsxs)("span",{className:"text-secondary/60",children:[s,":"]}),(0,t.jsxs)("button",{onClick:l,className:"flex items-center gap-1.5 px-2 py-1 rounded bg-paper/50 hover:bg-border/30  text-secondary hover:text-vermilion transition-all duration-200  border border-border/40 group focus:ring-2 focus:ring-vermilion/20 focus:outline-none",title:`å¤åˆ¶ ${s||"å†…å®¹"}`,"aria-label":a?"å·²å¤åˆ¶":`å¤åˆ¶ ${s?`${s}: `:""}${e}`,children:[(0,t.jsx)("span",{className:"font-mono text-secondary/80 group-hover:text-vermilion transition-colors",children:e}),(0,t.jsx)("svg",{className:`w-3.5 h-3.5 transition-colors ${a?"text-green-600":"text-secondary/50 group-hover:text-vermilion"}`,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:a?(0,t.jsx)("path",{d:"M5 13l4 4L19 7"}):(0,t.jsx)("path",{d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})]})]})}var o=e.i(76289),i=e.i(67920),c=e.i(18566),d=e.i(81827),x=e.i(47167);function h({id:e,assets:s,initialPage:a=1}){let n=(0,c.useRouter)(),l=(0,c.useSearchParams)(),o=(0,c.usePathname)(),[i,d]=(0,r.useState)(""),[h,u]=(0,r.useState)(null),[m,f]=(0,r.useState)(!0),[p,b]=(0,r.useState)("ç­‰å¾…æ•°æ®..."),g=(0,r.useRef)(null),j=(0,r.useRef)(null),y=(0,r.useRef)(null),v=(0,r.useRef)(null),[w,k]=(0,r.useState)(a),[N,_]=(0,r.useState)(a),[$,S]=(0,r.useState)(!0),[L,O]=(0,r.useState)(0),[T,C]=(0,r.useState)(0),[B,R]=(0,r.useState)(""),E="local"===x.default.env.NEXT_PUBLIC_MODE,[F,I]=(0,r.useState)({tex:!0,render:!0,images:!0}),D=[F.tex,F.render,F.images].filter(Boolean).length;(0,r.useEffect)(()=>{(async()=>{try{f(!0);let t=s.image_manifest_url?.replace(/\/images\/image_manifest\.json$/,"")||`/books/${e}`;if(s.tex_files&&s.tex_files.length>0){let e=`${t}/tex/${s.tex_files[0]}`;b(`æ­£åœ¨è·å–: ${e}`);let r=await fetch(e);if(r.ok){let e=await r.text();d(e),b(`è·å–æˆåŠŸ, ${e.length} å­—ç¬¦`)}else b(`è·å–å¤±è´¥: HTTP ${r.status}`)}else b("æ—  TeX æ–‡ä»¶");if(s.image_manifest_url){let e=await fetch(s.image_manifest_url);if(e.ok){let t=await e.json();u(t)}}}catch(e){console.error("Failed to load digital assets:",e),b(`åŠ è½½å¤±è´¥: ${e}`)}finally{f(!1)}})()},[e,s]),(0,r.useEffect)(()=>{m||!i||(g.current?(b("æ­£åœ¨åŠ è½½ webtex-cn åº“..."),(async()=>{try{if(!document.querySelector('link[href="/webtex-css/base.css"]')){let e=document.createElement("link");e.rel="stylesheet",e.href="/webtex-css/base.css",document.head.appendChild(e)}let e=await (()=>{let e=Error("Cannot find module 'webtex-cn'");throw e.code="MODULE_NOT_FOUND",e})(),t=e.default||e;if(R("0.1.2"),!t||"function"!=typeof t.renderToDOM)return void b("æ¨¡å—åŠ è½½å¤±è´¥: renderToDOM ä¸å­˜åœ¨");if(b("æ­£åœ¨æ’ç‰ˆ..."),g.current){t.renderToDOM(i,g.current,{cssBasePath:"/webtex-css/"});let e=g.current.querySelectorAll(".wtc-page");O(e.length),e.forEach((e,t)=>{e.style.margin="0 auto",e.style.padding="0",e.style.display=t+1===w?"block":"none"}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{M()})});let r=g.current.children.length;b(`æ’ç‰ˆå®Œæˆ, ${r} ä¸ªå…ƒç´ `)}}catch(t){let e=t instanceof Error?t.message:String(t);b(`æ’ç‰ˆå¤±è´¥: ${e}`),console.error("[DigitalizationView] Render error:",t)}})()):b("viewerRef æœªæŒ‚è½½"))},[i,m,w]);let M=()=>{let e=j.current,t=y.current,r=g.current;if(!e||!t||!r)return;t.style.transform="translateX(-50%) scale(1)";let s=r.querySelector(".wtc-page");if(!s)return;let a=e.clientWidth,n=e.clientHeight,l=s.offsetWidth,o=s.offsetHeight;if(0===l||0===o)return;let i=Math.max(Math.min(a/l,n/o,1.5),.1);t.style.transform=`translateX(-50%) scale(${i})`};(0,r.useEffect)(()=>{let e=j.current;if(!e)return;let t=new ResizeObserver(()=>{M()});return t.observe(e),()=>t.disconnect()},[]),(0,r.useEffect)(()=>{h?.volumes?.[0]?.files&&C(h.volumes[0].files.length)},[h]);let P=(e,t)=>{let r=Math.max(1,Math.min(t,"tex"===e?L:T));$?(k(r),_(r)):"tex"===e?k(r):_(r)};if((0,r.useEffect)(()=>{let e=new URLSearchParams(l.toString());w!==parseInt(l.get("page")||"0")&&(e.set("page",w.toString()),n.replace(`${o}?${e.toString()}`,{scroll:!1}))},[w,$,o,n,l]),m)return(0,t.jsx)("div",{className:"p-8 text-center text-secondary",children:"åŠ è½½æ•°å­—åŒ–èµ„æºä¸­..."});let U=s.image_manifest_url?.replace(/\/images\/image_manifest\.json$/,"")||`/books/${e}`;return(0,t.jsxs)("div",{className:"flex flex-col h-[calc(100vh-140px)] mt-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-center gap-2 mb-3 px-1",children:[{key:"tex",label:"TeX æºç ",icon:"{ }"},{key:"render",label:"æ’ç‰ˆé¢„è§ˆ",icon:"â—«"},{key:"images",label:"å½±å°å½±åƒ",icon:"ğŸ–¼"}].map(({key:e,label:r,icon:s})=>(0,t.jsxs)("button",{onClick:()=>{I(t=>{let r={...t,[e]:!t[e]};return r.tex||r.render||r.images?r:t})},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all
                            ${F[e]?"bg-ink/5 text-ink border border-border/60 shadow-sm":"bg-transparent text-secondary/50 border border-transparent hover:text-secondary hover:border-border/30"}`,children:[(0,t.jsx)("span",{className:"text-[11px]",children:s}),r]},e))}),(0,t.jsxs)("div",{className:"grid gap-4 h-full pb-4 transition-all duration-300",style:{gridTemplateColumns:`repeat(${D}, 1fr)`},children:[(0,t.jsxs)("div",{className:"border border-border/60 rounded-xl overflow-hidden flex flex-col bg-white/50 shadow-sm",style:{display:F.tex?void 0:"none"},children:[(0,t.jsxs)("div",{className:"bg-paper border-b border-border/60 px-4 py-2.5 text-xs font-bold text-secondary uppercase tracking-widest flex items-center justify-between",children:[(0,t.jsx)("span",{children:"TeX æºç "}),(0,t.jsx)("span",{className:"text-[10px] opacity-50 font-mono",children:s.tex_files?.[0]})]}),(0,t.jsx)("pre",{className:"flex-1 overflow-auto p-5 text-sm font-mono text-ink leading-relaxed selection:bg-vermilion/10",children:i||"æ—  TeX æºç "})]}),(0,t.jsxs)("div",{className:"border border-border/60 rounded-xl overflow-hidden flex flex-col bg-white shadow-sm",style:{display:F.render?void 0:"none"},children:[(0,t.jsxs)("div",{className:"bg-paper border-b border-border/60 px-4 py-2.5 text-xs font-bold text-secondary uppercase tracking-widest flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"WebTeX æ’ç‰ˆ"}),B&&(0,t.jsxs)("span",{className:"bg-ink/5 px-1.5 py-0.5 rounded text-[9px] font-mono text-secondary/60",children:["v",B]}),E&&(0,t.jsx)("span",{className:"bg-vermilion/5 text-vermilion px-1.5 py-0.5 rounded text-[9px]",children:"LOCAL"})]}),(0,t.jsx)("span",{className:"text-[10px] text-vermilion font-mono",children:p})]}),(0,t.jsx)("div",{ref:j,className:"flex-1 overflow-hidden bg-[#fafafa] relative",children:(0,t.jsx)("div",{ref:y,style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%) scale(1)",transformOrigin:"top center"},children:(0,t.jsx)("div",{ref:g,className:"wtc-scope"})})})]}),(0,t.jsxs)("div",{className:"border border-border/60 rounded-xl overflow-hidden flex flex-col bg-white/50 shadow-sm",style:{display:F.images?void 0:"none"},children:[(0,t.jsx)("div",{className:"bg-paper border-b border-border/60 px-4 py-2.5 text-xs font-bold text-secondary uppercase tracking-widest",children:"å½±å°æœ¬å½±åƒ"}),(0,t.jsxs)("div",{ref:v,className:"flex-1 overflow-hidden bg-[#fafafa]",children:[(0,t.jsx)("div",{className:"flex flex-col items-center justify-center h-full overflow-auto",children:h?.volumes?.[0]?.files?.[N-1]&&(0,t.jsx)("div",{className:"flex flex-col items-center justify-center bg-white",style:{height:"100%",width:"100%",flexShrink:0},children:(0,t.jsx)("div",{className:"relative w-full h-full overflow-hidden flex items-center justify-center p-2",children:(0,t.jsx)("img",{src:`${U}/images/vol01/${h.volumes[0].files[N-1].filename}`,alt:`Page ${N}`,className:"max-w-full max-h-full object-contain shadow-lg border border-border/40",loading:"lazy"})})})}),!h&&(0,t.jsx)("div",{className:"text-sm text-secondary p-4 text-center",children:"æ— å½±åƒèµ„æº"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6 px-4 py-3 bg-paper border border-border/60 rounded-xl shadow-inner-sm mt-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-[10px] font-bold text-secondary uppercase tracking-widest mr-2",children:"æ’ç‰ˆ"}),(0,t.jsx)("button",{onClick:()=>P("tex",w-1),disabled:w<=1,className:"p-1 px-2 rounded bg-white border border-border/60 hover:bg-ink/5 disabled:opacity-30 transition-colors",children:"â†"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-white border border-border/60 rounded text-sm font-mono",children:[(0,t.jsx)("input",{type:"number",value:w,onChange:e=>P("tex",parseInt(e.target.value)||1),className:"w-10 text-center bg-transparent border-none outline-none focus:ring-0"}),(0,t.jsx)("span",{className:"text-secondary/40",children:"/"}),(0,t.jsx)("span",{className:"text-secondary/60",children:L})]}),(0,t.jsx)("button",{onClick:()=>P("tex",w+1),disabled:w>=L,className:"p-1 px-2 rounded bg-white border border-border/60 hover:bg-ink/5 disabled:opacity-30 transition-colors",children:"â†’"})]}),(0,t.jsxs)("button",{onClick:()=>{let e=!$;S(e),e&&_(w)},className:`flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-bold transition-all border
                        ${$?"bg-vermilion/10 text-vermilion border-vermilion/30 shadow-sm":"bg-ink/5 text-secondary border-border/60"}`,children:[(0,t.jsx)("span",{className:"text-sm",children:$?"ğŸ”’":"ğŸ”“"}),"åŒæ­¥é”å®š"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-[10px] font-bold text-secondary uppercase tracking-widest mr-2",children:"å½±åƒ"}),(0,t.jsx)("button",{onClick:()=>P("images",N-1),disabled:N<=1,className:"p-1 px-2 rounded bg-white border border-border/60 hover:bg-ink/5 disabled:opacity-30 transition-colors",children:"â†"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-white border border-border/60 rounded text-sm font-mono",children:[(0,t.jsx)("input",{type:"number",value:N,onChange:e=>P("images",parseInt(e.target.value)||1),className:"w-10 text-center bg-transparent border-none outline-none focus:ring-0"}),(0,t.jsx)("span",{className:"text-secondary/40",children:"/"}),(0,t.jsx)("span",{className:"text-secondary/60",children:T})]}),(0,t.jsx)("button",{onClick:()=>P("images",N+1),disabled:N>=T,className:"p-1 px-2 rounded bg-white border border-border/60 hover:bg-ink/5 disabled:opacity-30 transition-colors",children:"â†’"})]})]})]})}function u({children:e}){return(0,t.jsx)("h2",{className:"text-xl font-bold text-ink mt-8 mb-4 tracking-wide border-b border-border/40 pb-2",children:e})}function m({label:e,children:r}){return(0,t.jsxs)("div",{className:"flex py-2.5 border-b border-border/20 last:border-b-0",children:[(0,t.jsx)("span",{className:"w-28 flex-shrink-0 text-sm text-secondary font-medium",children:e}),(0,t.jsx)("span",{className:"text-sm text-ink flex-1",children:r})]})}function f({authors:e}){return(0,t.jsx)("span",{children:e.map((e,r)=>(0,t.jsxs)("span",{children:[r>0&&"ã€",e.dynasty&&(0,t.jsxs)("span",{className:"text-secondary",children:["[",e.dynasty,"] "]}),e.name,e.role&&(0,t.jsxs)("span",{className:"text-secondary",children:[" (",e.role,")"]})]},r))})}function p({resources:e,label:r}){return 0===e.length?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u,{children:r}),(0,t.jsx)("ul",{className:"space-y-2",children:e.map((e,r)=>(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 mt-0.5 text-vermilion flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-vermilion hover:underline font-medium text-sm",children:e.name||e.title}),e.details&&(0,t.jsxs)("span",{className:"text-secondary text-xs ml-2",children:["â€” ",e.details]})]})]},r))})]})}function b({history:e}){return 0===e.length?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u,{children:"æµè½¬å†å²"}),(0,t.jsxs)("div",{className:"relative pl-6 space-y-4",children:[(0,t.jsx)("div",{className:"absolute left-2 top-2 bottom-2 w-px bg-border/60"}),e.map((e,r)=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute -left-4 top-1.5 w-2.5 h-2.5 rounded-full bg-vermilion border-2 border-white"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium text-ink",children:e.name}),e.description&&(0,t.jsx)("p",{className:"text-sm text-secondary mt-1",children:e.description})]})]},r))]})]})}function g({ids:e,label:r}){return 0===e.length?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u,{children:r}),(0,t.jsx)("ul",{className:"space-y-2",children:e.map(e=>(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 mt-0.5 text-vermilion flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),(0,t.jsx)(d.default,{id:e})]},e))})]})}function j(e){return(0,t.jsxs)("div",{className:"bg-paper/30 rounded-xl border border-border/40 p-5 mt-6",children:[e.authors&&e.authors.length>0&&(0,t.jsx)(m,{label:"collection"===e.type?"ç¼–è€…":"ä½œè€…",children:(0,t.jsx)(f,{authors:e.authors})}),e.publication_info?.year&&(0,t.jsx)(m,{label:"å¹´ä»£",children:e.publication_info.year}),e.current_location?.name&&(0,t.jsx)(m,{label:"ç°è—äº",children:e.current_location.name}),e.volume_count?.description&&(0,t.jsx)(m,{label:"å·å†Œ",children:e.volume_count.description}),e.page_count?.description&&(0,t.jsx)(m,{label:"é¡µæ•°",children:e.page_count.description}),e.contained_in&&e.contained_in.length>0&&(0,t.jsx)(m,{label:"æ”¶å½•äº",children:e.contained_in.join("ã€")}),e.work_id&&(0,t.jsx)(m,{label:"æ‰€å±ä½œå“",children:(0,t.jsx)(d.default,{id:e.work_id})}),e.parent_work&&(0,t.jsx)(m,{label:"ä¸Šçº§ä½œå“",children:(0,t.jsx)(d.default,{id:e.parent_work.id})}),e.parent_works&&e.parent_works.length>0&&(0,t.jsx)(m,{label:"ä¸Šçº§ä½œå“",children:(0,t.jsx)("span",{className:"flex flex-wrap gap-2",children:e.parent_works.map(e=>(0,t.jsx)(d.default,{id:e},e))})})]})}function y(e){return(0,t.jsxs)(t.Fragment,{children:[e.text_resources&&e.text_resources.length>0&&(0,t.jsx)(p,{resources:e.text_resources,label:"æ–‡å­—èµ„æº"}),e.image_resources&&e.image_resources.length>0&&(0,t.jsx)(p,{resources:e.image_resources,label:"å½±åƒèµ„æº"})]})}function v({id:e}){let{source:d}=(0,i.useSource)(),x=(0,c.useRouter)(),m=(0,c.useSearchParams)(),f=(0,c.usePathname)(),[p,v]=(0,r.useState)(null),[w,k]=(0,r.useState)(null),[N,_]=(0,r.useState)(!0),[$,S]=(0,r.useState)(null),L=m.get("tab")||"basic",O=parseInt(m.get("page")||"1")||1,T=e=>{let t=new URLSearchParams(m.toString());t.set("tab",e),"basic"===e&&t.delete("page"),x.push(`${f}?${t.toString()}`,{scroll:!1})};return((0,r.useEffect)(()=>{(async()=>{try{_(!0),S(null);let t=await (0,n.findBookById)(e,d);if(!t)return void S("not-found");v(t);let r=await (0,n.fetchBookDetail)(t,d);k(r)}catch(e){S(e instanceof Error?e.message:"åŠ è½½å¤±è´¥")}finally{_(!1)}})()},[e,d]),"not-found"===$&&(0,c.notFound)(),N)?(0,t.jsx)(a.default,{hideFooter:!0,children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-8 animate-pulse",children:[(0,t.jsx)("div",{className:"h-8 w-48 bg-paper/50 rounded mb-8"}),(0,t.jsx)("div",{className:"h-12 w-3/4 bg-paper/50 rounded mb-8"}),(0,t.jsx)("div",{className:"h-64 w-full bg-paper/50 rounded"})]})}):p&&w?(0,t.jsxs)(a.default,{hideFooter:!0,children:[(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-6 pt-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8 flex-wrap gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,t.jsxs)(s.default,{href:"/book-index",className:"flex items-center gap-1 text-sm text-secondary hover:text-vermilion transition-colors",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{d:"M15 19l-7-7 7-7"})}),(0,t.jsx)("span",{children:"è¿”å›ç´¢å¼•"})]}),(0,t.jsx)("span",{className:"text-secondary/30",children:"|"}),(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-paper text-secondary border border-border/60",children:(0,n.getTypeLabel)(p.type)}),(0,t.jsx)("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${p.isDraft?"text-orange-600 bg-orange-50":"text-green-600 bg-green-50"}`,children:(0,n.getStatusLabel)(p.isDraft)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(o.default,{}),(0,t.jsx)(l,{text:p.id,label:"ID"})]})]}),(0,t.jsx)("h1",{className:"text-4xl font-bold text-ink mb-2 tracking-wide",children:w.title}),(0,t.jsxs)("div",{className:"flex border-b border-border/40 mt-6 overflow-x-auto no-scrollbar",children:[(0,t.jsxs)("button",{onClick:()=>T("basic"),className:`px-6 py-3 text-sm font-medium transition-colors relative ${"basic"===L?"text-vermilion":"text-secondary hover:text-ink"}`,children:["åŸºæœ¬ä¿¡æ¯","basic"===L&&(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-vermilion"})]}),w.digital_assets&&(0,t.jsxs)("button",{onClick:()=>T("digital"),className:`px-6 py-3 text-sm font-medium transition-colors relative flex items-center gap-2 ${"digital"===L?"text-vermilion":"text-secondary hover:text-ink"}`,children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"æ•°å­—åŒ–","digital"===L&&(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-vermilion"})]})]})]}),"basic"===L?(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-6 pb-8 animate-in fade-in slide-in-from-bottom-2 duration-300",children:["book"===w.type&&(0,t.jsxs)(t.Fragment,{children:[j(w),w.description?.text&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u,{children:"ç®€ä»‹"}),(0,t.jsx)("p",{className:"text-base text-ink leading-loose",children:w.description.text})]}),y(w),w.location_history&&w.location_history.length>0&&(0,t.jsx)(b,{history:w.location_history}),w.related_books&&w.related_books.length>0&&(0,t.jsx)(g,{ids:w.related_books,label:"ç›¸å…³ç‰ˆæœ¬"})]}),"collection"===w.type&&(0,t.jsxs)(t.Fragment,{children:[j(w),w.description?.text&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u,{children:"ç®€ä»‹"}),(0,t.jsx)("p",{className:"text-base text-ink leading-loose",children:w.description.text})]}),y(w),w.history&&w.history.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u,{children:"å†å²æ²¿é©"}),(0,t.jsx)("ul",{className:"space-y-2",children:w.history.map((e,r)=>(0,t.jsxs)("li",{className:"text-sm text-ink leading-relaxed flex gap-2",children:[(0,t.jsx)("span",{className:"text-vermilion mt-1",children:"â€¢"}),(0,t.jsx)("span",{children:e})]},r))})]}),w.books&&w.books.length>0&&(0,t.jsx)(g,{ids:w.books,label:"æ”¶å½•ä¹¦ç±"})]}),"work"===w.type&&(0,t.jsxs)(t.Fragment,{children:[j(w),w.description?.text&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u,{children:"ç®€ä»‹"}),(0,t.jsx)("p",{className:"text-base text-ink leading-loose",children:w.description.text})]}),y(w),w.books&&w.books.length>0&&(0,t.jsx)(g,{ids:w.books,label:"ç›¸å…³ç‰ˆæœ¬"})]})]}):(0,t.jsx)("div",{className:"px-4 pb-8 animate-in fade-in slide-in-from-bottom-2 duration-300",children:w.digital_assets&&(0,t.jsx)(h,{id:e,assets:w.digital_assets,initialPage:O})})]}):null}e.s(["default",()=>v],45013)}]);