(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},85130,89271,e=>{"use strict";var t,r=((t={}).WORK="work",t.COLLECTION="collection",t.BOOK="book",t);e.s(["BookResourceType",()=>r],89271);var s=e.i(85149);let n={};async function a(e,t){try{let s=await fetch(e,{cache:"no-store",signal:AbortSignal.timeout(5e3)});if(!s.ok)throw Error(`Failed to fetch from ${e}: ${s.statusText}`);let n=await s.json(),a=[],o=(e,r)=>{e&&Object.values(e).forEach(e=>{a.push({id:e.id,name:e.title||e.name,type:r,isDraft:t,rawPath:e.path,author:e.author,collection:e.collection,year:e.year,holder:e.holder})})};return o(n.books,r.BOOK),o(n.collections,r.COLLECTION),o(n.works,r.WORK),a}catch(e){throw e}}async function o(e="github"){if(n[e])return n[e];let t=[],r=async t=>{if("github"===e)return a(t?s.GITHUB_BOOK_INDEX_DRAFT:s.GITHUB_BOOK_INDEX,t);let r=t?"book-index-draft":"book-index",n="main",o=`${s.JSDELIVR_FASTLY}/${s.GITHUB_ORG}/${r}@${n}/index.json`,i=`${s.JSDELIVR_CDN}/${s.GITHUB_ORG}/${r}@${n}/index.json`;try{return await a(o,t)}catch(e){return console.warn("Fastly index fetch failed, trying fallback:",e),await a(i,t)}};try{let e=await r(!0);t.push(...e)}catch(t){console.warn(`Failed to fetch draft index from ${e}:`,t)}try{let e=await r(!1);t.push(...e)}catch(t){console.warn(`Failed to fetch official index from ${e}:`,t)}let i=new Map;t.forEach(e=>{i.set(e.id,e)});let l=Array.from(i.values());return n[e]=l,l}async function i(e,t="github"){return(await o(t)).find(t=>t.id===e)||null}async function l(e,t="github"){if("github"===t){let r=e.isDraft?`${s.GITHUB_BASE}/${s.GITHUB_ORG}/book-index-draft/main`:`${s.GITHUB_BASE}/${s.GITHUB_ORG}/book-index/main`,n=`${r}/${e.rawPath}`,a=await fetch(n,{cache:"no-store",signal:AbortSignal.timeout(1e4)});if(!a.ok)throw Error(`Failed to fetch book detail from ${t}: ${a.statusText}`);return a.json()}let r=e.isDraft?"book-index-draft":"book-index",n="main",a=`${s.JSDELIVR_FASTLY}/${s.GITHUB_ORG}/${r}@${n}/${e.rawPath}`,o=`${s.JSDELIVR_CDN}/${s.GITHUB_ORG}/${r}@${n}/${e.rawPath}`;try{let e=await fetch(a,{cache:"no-store",signal:AbortSignal.timeout(8e3)});if(!e.ok)throw Error(`Fastly status: ${e.status}`);return await e.json()}catch(t){console.warn("Fastly fetch failed, trying fallback CDN:",t);let e=await fetch(o,{cache:"no-store",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw Error(`Failed to fetch book detail from CDN: ${e.statusText}`);return await e.json()}}function c(e){switch(e){case r.WORK:return"作品";case r.COLLECTION:return"丛编";case r.BOOK:return"书";default:return""}}function d(e){return e?"草稿":"正式"}e.s(["fetchAllBooks",()=>o,"fetchBookDetail",()=>l,"findBookById",()=>i,"getStatusLabel",()=>d,"getTypeLabel",()=>c],85130)},81827,e=>{"use strict";var t=e.i(18050),r=e.i(71645),s=e.i(22016),n=e.i(85130),a=e.i(67920),o=e.i(89271);function i({id:e,children:i,className:l,...c}){let{source:d}=(0,a.useSource)(),[x,h]=(0,r.useState)(null),[u,m]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let t=!0;return(async()=>{try{let r=await (0,n.findBookById)(e,d);t&&r&&(h(r.type),m(r.name))}catch(t){console.error(`Failed to fetch book info for ID: ${e}`,t)}})(),()=>{t=!1}},[e,d]),(0,t.jsxs)(s.default,{href:`/book-index/${e}`,className:`inline-flex items-center text-vermilion hover:underline font-medium decoration-dotted underline-offset-4 ${l||""}`,...c,children:[(()=>{let e="w-3.5 h-3.5 inline-block mr-1 opacity-70 align-middle";switch(x){case o.BookResourceType.BOOK:return(0,t.jsx)("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})});case o.BookResourceType.COLLECTION:return(0,t.jsx)("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})});case o.BookResourceType.WORK:return(0,t.jsx)("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})});default:return null}})(),(0,t.jsx)("span",{children:u||i||e})]})}e.s(["default",()=>i])},45013,e=>{"use strict";var t=e.i(18050),r=e.i(71645),s=e.i(22016),n=e.i(42303),a=e.i(85130);function o({text:e,label:s}){let[n,a]=(0,r.useState)(!1),o=async()=>{try{await navigator.clipboard.writeText(e),a(!0),setTimeout(()=>a(!1),2e3)}catch(e){console.error("Failed to copy:",e)}};return(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[s&&(0,t.jsxs)("span",{className:"text-secondary/60",children:[s,":"]}),(0,t.jsxs)("button",{onClick:o,className:"flex items-center gap-1.5 px-2 py-1 rounded bg-paper/50 hover:bg-border/30  text-secondary hover:text-vermilion transition-all duration-200  border border-border/40 group focus:ring-2 focus:ring-vermilion/20 focus:outline-none",title:`复制 ${s||"内容"}`,"aria-label":n?"已复制":`复制 ${s?`${s}: `:""}${e}`,children:[(0,t.jsx)("span",{className:"font-mono text-secondary/80 group-hover:text-vermilion transition-colors",children:e}),(0,t.jsx)("svg",{className:`w-3.5 h-3.5 transition-colors ${n?"text-green-600":"text-secondary/50 group-hover:text-vermilion"}`,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:n?(0,t.jsx)("path",{d:"M5 13l4 4L19 7"}):(0,t.jsx)("path",{d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})]})]})}var i=e.i(76289),l=e.i(67920),c=e.i(18566),d=e.i(81827);function x({children:e}){return(0,t.jsx)("h2",{className:"text-xl font-bold text-ink mt-8 mb-4 tracking-wide border-b border-border/40 pb-2",children:e})}function h({label:e,children:r}){return(0,t.jsxs)("div",{className:"flex py-2.5 border-b border-border/20 last:border-b-0",children:[(0,t.jsx)("span",{className:"w-28 flex-shrink-0 text-sm text-secondary font-medium",children:e}),(0,t.jsx)("span",{className:"text-sm text-ink flex-1",children:r})]})}function u({authors:e}){return(0,t.jsx)("span",{children:e.map((e,r)=>(0,t.jsxs)("span",{children:[r>0&&"、",e.dynasty&&(0,t.jsxs)("span",{className:"text-secondary",children:["[",e.dynasty,"] "]}),e.name,e.role&&(0,t.jsxs)("span",{className:"text-secondary",children:[" (",e.role,")"]})]},r))})}function m({resources:e,label:r}){return 0===e.length?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{children:r}),(0,t.jsx)("ul",{className:"space-y-2",children:e.map((e,r)=>(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 mt-0.5 text-vermilion flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-vermilion hover:underline font-medium text-sm",children:e.name}),e.details&&(0,t.jsxs)("span",{className:"text-secondary text-xs ml-2",children:["— ",e.details]})]})]},r))})]})}function p({history:e}){return 0===e.length?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{children:"流转历史"}),(0,t.jsxs)("div",{className:"relative pl-6 space-y-4",children:[(0,t.jsx)("div",{className:"absolute left-2 top-2 bottom-2 w-px bg-border/60"}),e.map((e,r)=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute -left-4 top-1.5 w-2.5 h-2.5 rounded-full bg-vermilion border-2 border-white"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium text-ink",children:e.name}),e.description&&(0,t.jsx)("p",{className:"text-sm text-secondary mt-1",children:e.description})]})]},r))]})]})}function f({ids:e,label:r}){return 0===e.length?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{children:r}),(0,t.jsx)("ul",{className:"space-y-2",children:e.map(e=>(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 mt-0.5 text-vermilion flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),(0,t.jsx)(d.default,{id:e})]},e))})]})}function j({id:e}){let{source:j}=(0,l.useSource)(),[b,g]=(0,r.useState)(null),[k,y]=(0,r.useState)(null),[v,w]=(0,r.useState)(!0),[N,_]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{try{w(!0),_(null);let t=await (0,a.findBookById)(e,j);if(!t)return void _("not-found");g(t);let r=await (0,a.fetchBookDetail)(t,j);y(r)}catch(e){_(e instanceof Error?e.message:"加载失败")}finally{w(!1)}})()},[e,j]),"not-found"===N&&(0,c.notFound)(),v)?(0,t.jsx)(n.default,{children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-8 animate-pulse",children:[(0,t.jsx)("div",{className:"h-8 w-48 bg-paper/50 rounded mb-8"}),(0,t.jsx)("div",{className:"h-12 w-3/4 bg-paper/50 rounded mb-8"}),(0,t.jsx)("div",{className:"h-64 w-full bg-paper/50 rounded"})]})}):b&&k?(0,t.jsx)(n.default,{children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8 flex-wrap gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,t.jsxs)(s.default,{href:"/book-index",className:"flex items-center gap-1 text-sm text-secondary hover:text-vermilion transition-colors",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{d:"M15 19l-7-7 7-7"})}),(0,t.jsx)("span",{children:"返回索引"})]}),(0,t.jsx)("span",{className:"text-secondary/30",children:"|"}),(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-paper text-secondary border border-border/60",children:(0,a.getTypeLabel)(b.type)}),(0,t.jsx)("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${b.isDraft?"text-orange-600 bg-orange-50":"text-green-600 bg-green-50"}`,children:(0,a.getStatusLabel)(b.isDraft)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(i.default,{}),(0,t.jsx)(o,{text:b.id,label:"ID"})]})]}),(0,t.jsx)("h1",{className:"text-4xl font-bold text-ink mb-2 tracking-wide",children:k.title}),"book"===k.type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-paper/30 rounded-xl border border-border/40 p-5 mt-6",children:[k.authors&&k.authors.length>0&&(0,t.jsx)(h,{label:"作者",children:(0,t.jsx)(u,{authors:k.authors})}),k.publication_info?.year&&(0,t.jsx)(h,{label:"年代",children:k.publication_info.year}),k.current_location?.name&&(0,t.jsx)(h,{label:"现藏于",children:k.current_location.name}),k.volume_count?.description&&(0,t.jsx)(h,{label:"卷册",children:k.volume_count.description}),k.page_count?.description&&(0,t.jsx)(h,{label:"页数",children:k.page_count.description}),k.contained_in&&k.contained_in.length>0&&(0,t.jsx)(h,{label:"收录于",children:k.contained_in.join("、")}),k.work_id&&(0,t.jsx)(h,{label:"所属作品",children:(0,t.jsx)(d.default,{id:k.work_id})})]}),k.description?.text&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{children:"简介"}),(0,t.jsx)("p",{className:"text-base text-ink leading-loose",children:k.description.text})]}),k.text_resources&&k.text_resources.length>0&&(0,t.jsx)(m,{resources:k.text_resources,label:"文字资源"}),k.image_resources&&k.image_resources.length>0&&(0,t.jsx)(m,{resources:k.image_resources,label:"影像资源"}),k.location_history&&k.location_history.length>0&&(0,t.jsx)(p,{history:k.location_history}),k.related_books&&k.related_books.length>0&&(0,t.jsx)(f,{ids:k.related_books,label:"相关版本"})]}),"collection"===k.type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-paper/30 rounded-xl border border-border/40 p-5 mt-6",children:[k.authors&&k.authors.length>0&&(0,t.jsx)(h,{label:"编者",children:(0,t.jsx)(u,{authors:k.authors})}),k.publication_info?.year&&(0,t.jsx)(h,{label:"年代",children:k.publication_info.year}),k.current_location?.name&&(0,t.jsx)(h,{label:"现藏于",children:k.current_location.name}),k.volume_count?.description&&(0,t.jsx)(h,{label:"卷册",children:k.volume_count.description}),k.contained_in&&k.contained_in.length>0&&(0,t.jsx)(h,{label:"收录于",children:k.contained_in.join("、")})]}),k.description?.text&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{children:"简介"}),(0,t.jsx)("p",{className:"text-base text-ink leading-loose",children:k.description.text})]}),k.history&&k.history.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{children:"历史沿革"}),(0,t.jsx)("ul",{className:"space-y-2",children:k.history.map((e,r)=>(0,t.jsxs)("li",{className:"text-sm text-ink leading-relaxed flex gap-2",children:[(0,t.jsx)("span",{className:"text-vermilion mt-1",children:"•"}),(0,t.jsx)("span",{children:e})]},r))})]}),k.books&&k.books.length>0&&(0,t.jsx)(f,{ids:k.books,label:"收录书籍"})]}),"work"===k.type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-paper/30 rounded-xl border border-border/40 p-5 mt-6",children:[k.authors&&k.authors.length>0&&(0,t.jsx)(h,{label:"作者",children:(0,t.jsx)(u,{authors:k.authors})}),k.parent_works&&k.parent_works.length>0&&(0,t.jsx)(h,{label:"上级作品",children:(0,t.jsx)("span",{className:"flex flex-wrap gap-2",children:k.parent_works.map(e=>(0,t.jsx)(d.default,{id:e},e))})})]}),k.description?.text&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{children:"简介"}),(0,t.jsx)("p",{className:"text-base text-ink leading-loose",children:k.description.text})]}),k.books&&k.books.length>0&&(0,t.jsx)(f,{ids:k.books,label:"相关版本"})]})]})}):null}e.s(["default",()=>j],45013)}]);